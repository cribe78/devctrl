var DevCtrl={stateConfig:["$stateProvider","$locationProvider","$urlRouterProvider",function(b,d,a){b.state("rooms",{url:"/rooms",scope:!0,controller:"RoomsCtrl",controllerAs:"rooms",templateUrl:"ng/locations.html",resolve:DevCtrl.Common.Resolve,data:{title:"Locations"}}).state("rooms.room",{url:"/:name",templateUrl:"ng/room.html",controller:"RoomCtrl",controllerAs:"room",data:{listByName:"rooms",title:!1}}).state("endpoints",{url:"/devices",templateUrl:"ng/endpoints.html",resolve:DevCtrl.Common.Resolve,
data:{title:"Devices"}}).state("endpoints.endpoint",{url:"/:id",templateUrl:"ng/endpoint.html",controller:"EndpointCtrl",controllerAs:"endpoint",data:{listByName:"control_endpoints",title:!1}}).state("config",{url:"/config",scope:!0,templateUrl:"ng/config.html",resolve:DevCtrl.Common.Resolve,data:{title:"Configuration"}}).state("config.data",{url:"/data",templateUrl:"ng/data.html",data:{title:"Data Tables"}}).state("config.log",{url:"/log",templateUrl:"ng/log.html",controller:"LogCtrl",controllerAs:"log",
resolve:DevCtrl.Log.Resolve,data:{title:"Log Viewer"}}).state("config.data.table",{url:"/:name",templateUrl:"ng/tableeditor.html",controller:"TableCtrl",controllerAs:"table",resolve:DevCtrl.Table.Resolve,data:{title:"Table Editor"}});a.when("/","/rooms");d.html5Mode(!0)}]};DevCtrl.Common={};
DevCtrl.Common.Resolve={loadControls:function(b){return b.getTablePromise("controls")},loadControlTemplates:function(b){return b.getTablePromise("control_templates")},loadRooms:function(b){return b.getTablePromise("rooms")},loadPanels:function(b){return b.getTablePromise("panels")},loadPanelControls:function(b){return b.getTablePromise("panel_controls")},loadEndpointTypes:function(b){return b.getTablePromise("endpoint_types")},loadControlEndpoints:function(b){return b.getTablePromise("control_endpoints")},loadUserInfo:function(b){return b.getAdminAuth()}};DevCtrl.ObjectEditor={};DevCtrl.ObjectEditor.Directive=[function(){return{scope:{object:"="},bindToController:!0,controller:function(){if(!angular.isDefined(this.object)||null==this.object||angular.isArray(this.object))this.object={};this.addItem=function(b,d){angular.isDefined(this.newKey)&&angular.isDefined(this.newVal)&&(this.object[this.newKey]=this.newVal);this.newVal=this.newKey=void 0;angular.element("#oe-new-key").focus()}},controllerAs:"obj",templateUrl:"ng/object-editor.html"}}];DevCtrl.Room={};
DevCtrl.Room.Ctrl=["$stateParams","DataService",function(b,d){var a=this;this.roomName=b.name;this.rooms=d.getTable("rooms");angular.forEach(this.rooms.listed,function(c){c.fields.name==a.roomName&&(a.obj=c,a.id=c.id)});this.panels=this.obj.referenced.panels;this.addPanel=function(c){d.editRecord(c,"0","panels",{room_id:a.id})};this.config=d.config;var c={};angular.isObject(this.config.rooms)||(this.config.rooms={});angular.isObject(this.config.rooms[a.id])||(this.config.rooms[this.id]={groups:{}});
c=this.config.rooms[this.id];this.getGroups=function(){var g={};angular.forEach(c.groups,function(a,c){g[c]=!0});angular.forEach(a.panels,function(a){angular.isDefined(c.groups[a.fields.grouping])||(c.groups[a.fields.grouping]={opened:!1});g[a.fields.grouping]=!1});angular.forEach(g,function(a,g){a&&delete c.groups[g]});return c.groups};this.panelControls=function(a){if(angular.isDefined(a.referenced.panel_controls))return a.referenced.panel_controls};this.toggleGroup=function(a){a.opened=!a.opened;
d.updateConfig()}}];DevCtrl.MainCtrl=["$state","$mdSidenav","DataService","MenuService",function(b,d,a,c){this.msg="Hello World!";this.tiles=[{img:"/images/orc.png"},{img:"/images/pict.png"},{img:"/images/sage.png"}];this.$state=b;this.schema=a.schema;this.menu=c;this.control_endpoints=a.getTable("control_endpoints");this.config=a.config;this.user=a.dataModel.user;this.updateConfig=function(){a.updateConfig()};this.toggleSidenav=function(a){d(a).toggle()};this.go=function(a){angular.isString(a)?b.go(a):b.go(a.name,a.params)};
this.addEndpoint=function(c){a.editRecord(c,0,"control_endpoints")};this.addEndpointType=function(c){a.editRecord(c,0,"endpoint_types")};this.dataModel=a.dataModel;this.title="DevCtrl";this.top=!0;this.adminEnabled=function(){return a.isAdminAuthorized()};this.adminLogin=function(){a.getAdminAuth(!0)};this.revokeAdmin=function(){a.revokeAdminAuth()}}];DevCtrl.AdminOnly={};DevCtrl.AdminOnly.Directive=["$compile","DataService",function(b,d){return{restrict:"A",replace:!1,terminal:!0,priority:1E3,link:function(a,c,g){var h=!1;"invert"==c.attr("devctrl-admin-only")&&(h=!0);c.removeAttr("devctrl-admin-only");c.attr("ng-if","adminEnabled()");a.adminEnabled=function(){var a=d.isAdminAuthorized()&&d.config.editEnabled;h&&(a=!a);return a};b(c)(a)}}}];DevCtrl.Menu={};DevCtrl.Menu.Directive=["MenuService","$state",function(b,d){return{scope:!0,bindToController:{},controller:function(a,c){this.service=a},controllerAs:"menu",templateUrl:"ng/menu.html"}}];DevCtrl.DataService={};
DevCtrl.DataService.factory=["$window","$http","$mdToast","$timeout","socketFactory","$mdDialog","$location",function(b,d,a,c,g,h,k){var e={user:{username:null,admin:!1},applog:[]},l={},r=!1,t=d.get("schema.php").success(function(a){angular.isDefined(a.schema)&&angular.forEach(a.schema,function(a,c){var p=f.getSchema(c);angular.merge(p,a);angular.isDefined(p.foreign_keys)&&angular.forEach(p.foreign_keys,function(a,c){p.referenced[a]=c})});r=!0}).error(function(a){f.errorToast(a)}),m=io("https://devctrl.dwi.ufl.edu/");
g=g({ioSocket:m});var q={},n={},m={editEnabled:!0};if("undefined"!==typeof b.localStorage){var u=b.localStorage.config;angular.isString(u)?m=JSON.parse(u):b.localStorage.config=JSON.stringify(m)}var f={config:m,messenger:g,dataModel:e,schema:l,addRow:function(a,c){d.post("data.php",a).then(function(d){var b=Object.keys(d.data.add[a.tableName])[0];console.log("new record "+b+"added to "+a.tableName);f.loadData(d.data);d=e[a.tableName].indexed[b];angular.forEach(a,function(c,d){"table"!=d&&(a[d]=null)});
angular.isFunction(c)&&c(d)},function(a){f.errorToast(a.data)})},deleteRow:function(a){var c="data.php/"+a.tableName+"/"+a.id,b=!1;angular.forEach(a.referenced,function(a,c){0<Object.keys(a).length&&(b=c)});b?f.errorToast({error:"Cannot delete "+a.tableName+" record due to foreign key constraint on "+b}):d.delete(c).success(function(a){f.loadData(a)}).error(function(a){f.errorToast(a)})},editEnum:function(a,c,d,b){angular.isObject(b)||(b={});h.show({targetEvent:a,locals:{myEnum:c,enumRefRecord:d,
options:b},controller:DevCtrl.EnumEditor.Ctrl,controllerAs:"editor",bindToController:!0,templateUrl:"ng/enum-editor.html",clickOutsideToClose:!0,hasBackdrop:!1})},editRecord:function(a,c,b,d){"0"!==c?c=f.getRowRef(b,c):(c=f.getNewRowRef(b),angular.isObject(d)&&angular.merge(c.fields,d));h.show({targetEvent:a,locals:{obj:c},controller:DevCtrl.Record.Ctrl,controllerAs:"record",bindToController:!0,templateUrl:"ng/record.html",clickOutsideToClose:!0,hasBackdrop:!1})},editRecordClose:function(){h.hide()},
errorToast:function(c){var b="An unknown error has occured";angular.isDefined(c.error)&&(b=c.error);a.show({templateUrl:"ng/error-toast.html",locals:{message:b},controllerAs:"toast",controller:"RoomsCtrl",bindToController:!0,position:"top right",hideDelay:3E3})},getAdminAuth:function(a){var c="admin_auth.php";a&&(c="admin_auth.php?logon=1&location="+k.path());return d.get(c).then(function(a){angular.isDefined(a.data.user)?angular.merge(e.user,a.data.user):console.log("admin_auth did not return an admin status")},
function(c){"401"==c.status&&(a&&angular.isDefined(c.data.location)?window.location=c.data.location:(angular.isDefined(c.data.user)&&angular.merge(e.user,c.data.user),f.errorToast(c.data)))})},getLog:function(){return d.get("log.php").then(function(a){angular.isDefined(a.data.applog)&&(e.applog.length=0,angular.merge(e.applog,a.data.applog))})},getNewRowRef:function(a){var c={id:"0",referenced:{},tableName:a,fields:{}};a=f.getSchema(a);angular.forEach(a.fields,function(a,b){c.fields[b]=""});return c},
getRowRef:function(a,c){if(!angular.isDefined(a))return console.error("error looking up record for undefined table"),{};if(!angular.isDefined(c)||null===c)return console.error("error looking up %s record for undefined key",a),{};var b=this.getTableRef(a);if(angular.isString(l[a].pk))return angular.isDefined(b.indexed[c])||(b.indexed[c]={fields:{},foreign:{},id:c,loaded:!1,referenced:{},tableName:a},b.listed.push(b.indexed[c])),b.indexed[c];console.error("multi column keys not supported, table %s",
a)},getMenu:function(){angular.isDefined(e.menu)||(e.menu={items:{}},d.get("menu.php").success(function(a){angular.isDefined(a.menu.items)?(console.log("test/menu.php loaded"),e.menu.items=a.menu.items):console.log("test/menu.php did not return a valid menu object")}).error(function(a){f.errorToast(a)}));return e.menu},getSchema:function(a){l.loaded||angular.isDefined(l[a])||(l[a]={referenced:{},foreign_keys:{}});return l[a]},getTable:function(a){angular.isDefined(e[a])?angular.isDefined(n[a])||(n[a]=
this.getTablePromise(a)):(this.getTableRef(a),n[a]=this.getTablePromise(a));return e[a]},getTablePromise:function(a){if(angular.isDefined(n[a]))return n[a];if(angular.isDefined(a))return d.get("data.php?table="+a).success(function(a){f.loadData(a)}).error(function(a){f.errorToast(a)});console.error("error: attempt to fetch undefined table!")},getTableRef:function(a){angular.isDefined(e[a])||(e[a]={listed:[],indexed:{},loaded:!1});return e[a]},isAdminAuthorized:function(){return e.user.admin},loadData:function(a){r?
f.loadDataKernel(a):t=t.then(function(){f.loadDataKernel(a)})},loadDataKernel:function(a){angular.isDefined(a.update)&&angular.forEach(a.update,function(a,c){angular.forEach(a,function(a,b){var d=f.getRowRef(c,b);angular.merge(d.fields,a)})});angular.isDefined(a.add)&&angular.forEach(a.add,function(a,c){var b=f.getSchema(c),d=b.pk,g=b.foreign_keys;angular.forEach(a,function(a,b){if(angular.isString(d)){var h=f.getRowRef(c,b);angular.merge(h.fields,a);h.loaded=!0;angular.forEach(g,function(a,b){if(null!==
h.fields[b]){var d=f.getRowRef(a,h.fields[b]);angular.isDefined(d.referenced[c])||(d.referenced[c]={});d.referenced[c][h.id]=h;h.foreign[a]=d;h.foreign[b]=d}else h.foreign[a]=null,h.foreign[b]=null})}else console.error("Error loading %s, multi-keyed records not supported",c)})});angular.isDefined(a.delete)&&angular.forEach(a.delete,function(a,c){var b=f.getSchema(c).pk;angular.forEach(a,function(a,b){angular.forEach(e[c].indexed[b].foreign,function(a,d){angular.isDefined(a.referenced[c][b])&&delete a.referenced[c][b]});
delete e[c].indexed[b]});e[c].listed.length=0;angular.forEach(e[c].indexed,function(a,d){angular.isString(b)?e[c].listed.push(a):angular.forEach(a,function(a){e[c].listed.push(a)})})})},revokeAdminAuth:function(){d.get("admin_auth_revoke.php").then(function(a){angular.isDefined(a.data.user)?angular.merge(e.user,a.data.user):console.log("revoke admin_auth did not return user info")},function(a){f.errorToast(a.data)})},updateConfig:function(){"undefined"!==typeof b.localStorage&&(b.localStorage.config=
JSON.stringify(f.config))},updateControlValue:function(a){angular.isDefined(q[a.id])&&c.cancel(q[a.id]);q[a.id]=c(function(a,c){var b="control.php/"+a.id;pendingDebounce=!1;d.put(b,a.fields).success(function(a){c.loadData(a)}).error(function(a){c.errorToast(a)})},200,!0,a,f)},updateRow:function(a){d.put("data.php/"+a.tableName+"/"+a.id,a.fields).success(function(a){f.loadData(a)}).error(function(a){f.errorToast(a)})}};g.on("control-data",function(a){f.loadData(a)});g.on("log-data",function(a){f.dataModel.applog.push(a)});
return f}];DevCtrl.Slider2d={};
DevCtrl.Slider2d.Directive=["DataService",function(b){return{scope:{control:"="},bindToController:!0,controller:function(b){var a=this,c,g;this.xValue=function(b){angular.isDefined(b)?(c=b,a.control.ctrl.fields.value=c+","+g):this.setXYVals();return c};this.yValue=function(b){angular.isDefined(b)?(g=b,a.control.ctrl.fields.value=c+","+g):this.setXYVals();return g};this.setXYVals=function(){var b=a.control.ctrl.fields.value.split(",");c=angular.isDefined(b[0])?b[0]:0;c=parseInt(c);g=angular.isDefined(b[1])?
b[1]:0;g=parseInt(g)};this.setXYVals();this.updateValue=function(){b.updateControlValue(a.control.ctrl)}},controllerAs:"slider2d",templateUrl:"ng/controls/slider2d-directive.html"}}];DevCtrl.EnumSelect={};
DevCtrl.EnumSelect.Directive=["DataService",function(b){return{scope:{tableName:"=table",field:"=",selectModel:"="},bindToController:!0,controller:function(b){this.enums=b.getTable("enums");this.enumVals=b.getTable("enum_vals");this.schema=b.getSchema(this.tableName);this.enumId=function(){var a=0,c=this.tableName+"."+this.field.name;angular.forEach(this.enums.indexed,function(b,d){b.fields.name==c&&(a=d)});return a};this.options=function(){var a=this.enumId(),c={};0<a&&(c=this.enums.indexed[a].referenced.enum_vals);return c}},
controllerAs:"enumSelect",templateUrl:"ng/enum-select.html"}}];DevCtrl.Ctrl={};
DevCtrl.Ctrl.Directive=["DataService",function(b){return{scope:{panelControl:"=",controlId:"="},bindToController:!0,controller:function(b){(this.panelContext=angular.isDefined(this.panelControl))?(this.ctrl=this.panelControl.foreign.controls,this.name=this.panelControl.fields.name):(this.ctrl=b.getTable("controls").indexed[this.controlId],this.name=this.ctrl.fields.name);this.ctrlName=function(){return this.panelContext?this.panelControl.fields.name:""!=this.ctrl.fields.name?this.ctrl.fields.name:this.ctrl.foreign.control_templates.fields.name};
this.template=this.ctrl.foreign.control_templates;this.config=function(a){if(angular.isObject(this.ctrl.fields.config)&&angular.isDefined(this.ctrl.fields.config[a]))return this.ctrl.fields.config[a];if(angular.isObject(this.template.fields.config)&&angular.isDefined(this.template.fields.config[a]))return this.template.fields.config[a]};this.intConfig=function(c){c=a.config(c);return parseInt(c)};this.appConfig=b.config;this.type=this.template.fields.usertype;this.enums=b.getTable("enums");this.enumVals=
b.getTable("enum_vals");var a=this;this.normalizedValue=function(){var c=a.ctrl.fields.value,b=a.intConfig("max"),d=a.intConfig("min"),c=c<d?d:c;return((c>b?b:c)+(0-d))*(b-d)/100};this.updateValue=function(){b.updateControlValue(a.ctrl)};this.editOptions=function(c){b.editEnum(c,null,a.ctrl,{title:"Edit "+a.name+" options"})};this.selectMenuItem=function(c){a.ctrl.fields.value=c;a.updateValue()};this.selectOptions=function(){var c=a.ctrl.fields.enum_id,b={};0<c&&(b=a.enums.indexed[c].referenced.enum_vals);
return b};this.selectValueName=function(){var c=a.selectOptions(),b=a.ctrl.fields.value,d="";angular.forEach(c,function(a){a.fields.value==b&&(d=a.fields.name)});return d};this.editPanelControl=function(c){b.editRecord(c,a.panelControl.id,"panel_controls")};this.editControl=function(c){b.editRecord(c,a.ctrl.id,"controls")};this.editTemplate=function(c){b.editRecord(c,a.template.id,"control_templates")}},controllerAs:"ctrl",templateUrl:"ng/ctrl.html"}}];DevCtrl.Record={};DevCtrl.Record.Ctrl=["DataService",function(b){this.newRow="0"===this.obj.id;this.schema=b.getSchema(this.obj.tableName);var d=this;this.addRow=function(){b.addRow(d.obj);b.editRecordClose()};this.deleteRow=function(){b.deleteRow(d.obj);b.editRecordClose()};this.updateRow=function(){b.updateRow(d.obj);b.editRecordClose()};this.cloneRow=function(){var a=b.getNewRowRef(d.obj.tableName);a.fields=d.obj.fields;b.addRow(a);b.editRecordClose()};this.close=function(){b.editRecordClose()}}];DevCtrl.Log={};DevCtrl.Log.Ctrl=["DataService",function(b){this.applog=b.dataModel.applog}];DevCtrl.Log.Resolve={loadLog:["DataService",function(b){return b.getLog()}]};DevCtrl.MenuService={};
DevCtrl.MenuService.factory=["$state","DataService",function(b,d){var a={pageTitle:function(){return b.current.title||b.params.name},parentState:function(){return b.get("^")},isFirstLevel:function(){return""===b.current.name||""===b.get("^").name},items:{},states:function(){return b.get()},menuItems:function(){var c=b.get();angular.forEach(c,function(c,d){""!=c.name&&(c.isOpened=b.includes(c),""==b.get("^",c).name&&(a.items[c.name]=c,angular.isDefined(c.substates)||(c.substates={})),angular.isDefined(c.data.title)&&
(c.title=c.data.title))});angular.forEach(c,function(c,h){if(""!=c.name){var k=b.get("^",c);if(angular.isDefined(a.items[k.name]))if(angular.isDefined(c.data.listByName)){var e=d.getTable(c.data.listByName).listed;angular.forEach(e,function(a){angular.isDefined(k.substates[a.id])?(k.substates[a.id].params.name=a.fields.name,k.substates[a.id].title=a.fields.name):k.substates[a.id]={name:c.name,params:{name:a.fields.name,id:a.id},title:a.fields.name}})}else a.items[k.name].substates[c.name]=c}});return a.items}};
return a}];DevCtrl.EndpointStatus={};
DevCtrl.EndpointStatus.Directive=["DataService",function(b){return{scope:{endpointId:"="},bindToController:!0,controller:function(b){var a=this;this.endpoint=b.getRowRef("control_endpoints",this.endpointId);this.status=function(){return a.endpoint.fields.enabled?""==a.endpoint.fields.status||null==a.endpoint.fields.status?"unknown":a.endpoint.fields.status:"disabled"};this.statusIcon=function(){var c=a.status();return"online"==c?"sync":"disconnected"==c?"sync_problem":"disabled"==c?"sync_disabled":
"help"};this.statusIconClasses=function(){var c=a.status();return"disabled"==c?"md-disabled":"disconnected"==c?"md-warn":"md-primary md-hue-2"}},controllerAs:"endpointStatus",templateUrl:"ng/endpoint-status.html"}}];DevCtrl.Endpoint={};
DevCtrl.Endpoint.Ctrl=["$stateParams","DataService",function(b,d){var a=this;this.endpointId=b.id;this.endpoints=d.getTable("control_endpoints");this.obj=this.endpoints.indexed[this.endpointId];b.name=this.obj.fields.name;this.controls=this.obj.referenced.controls;this.togglePanel=function(a){angular.isDefined(a.opened)?a.opened=!a.opened:a.opened=!0};this.isPanelOpen=function(a){return angular.isDefined(a.opened)&&a.opened};this.addTemplate=function(c){d.editRecord(c,"0","control_templates",{endpoint_type_id:a.obj.fields.endpoint_type_id})};
this.editEndpoint=function(a){d.editRecord(a,this.endpointId,"control_endpoints")}}];DevCtrl.PanelControlSelector={};
DevCtrl.PanelControlSelector.Ctrl=["$mdDialog","DataService",function(b,d){var a=this;this.endpointTypes=d.getTable("endpoint_types");this.endpoints=d.getTable("control_endpoints");this.controls=d.getTable("controls");this.control_templates=d.getTable("control_templates");this.newPanelControl=d.getNewRowRef("panel_controls");this.newPanelControl.fields.panel_id=this.panelId;this.endpointTypesSelected=[];this.endpointsSelected=[];this.getEndpointTypes=function(){return this.endpointTypes.indexed};this.getEndpoints=
function(){return this.endpoints.indexed};this.controlList={};this.getControls=function(){angular.forEach(a.controls.indexed,function(c){var b=!1,d=!0;if(angular.isArray(a.endpointsSelected)&&0<a.endpointsSelected.length){var d=!1,k=c.fields.control_endpoint_id;angular.forEach(a.endpointsSelected,function(a){a==k&&(b=!0)})}else if(angular.isArray(a.endpointTypesSelected)&&0<a.endpointTypesSelected.length){var d=!1,e=c.foreign.control_endpoints.fields.endpoint_type_id;angular.forEach(a.endpointTypesSelected,
function(a){e==a&&(b=!0)})}b||d?a.controlList[c.id]=c:delete a.controlList[c.id]});return a.controlList};this.endpointList={};this.getEndpoints=function(){angular.forEach(a.endpoints.indexed,function(c){var b=!1,d=!0;if(angular.isArray(a.endpointTypesSelected)&&0<a.endpointTypesSelected.length){var d=!1,k=c.fields.endpoint_type_id;angular.forEach(a.endpointTypesSelected,function(a){k==a&&(b=!0)})}b||d?a.endpointList[c.id]=c:delete a.endpointList[c.id]});return a.endpointList};this.clearEndpointTypes=
function(){a.endpointTypesSelected=void 0};this.clearEndpoints=function(){a.endpointsSelected=void 0};this.addPanelControl=function(){d.addRow(a.newPanelControl);b.hide()};this.cancelAdd=function(){b.hide()}}];DevCtrl.EnumEditor={};
DevCtrl.EnumEditor.Ctrl=["$mdDialog","DataService",function(b,d){var a=this;this.enums=d.getTable("enums");this.enumVals=d.getTable("enum_vals");this.newEnumValue=d.getNewRowRef("enum_vals");this.isAddingEnum=!1;this.title=function(){return angular.isString(a.options.title)?a.options.title:"Edit "+a.myEnum.fields.name+" values"};this.isEnumSelectable=function(){return angular.isObject(a.enumRefRecord)};this.updateEnumValue=function(a){d.updateRow(a)};this.addEnumValue=function(){a.newEnumValue.fields.enum_id=a.myEnum.id;
a.newEnumValue.fields.enabled=1;d.addRow(a.newEnumValue);a.newEnumValue=d.getNewRowRef("enum_vals")};this.newEnumCallback=function(c){a.enumRefRecord.fields.enum_id=c.id;a.updateEnum()};this.deleteEnumValue=function(a){d.deleteRow(a)};this.updateEnum=function(){0==a.enumRefRecord.fields.enum_id?a.isAddingEnum=!0:(a.myEnum=a.enums.indexed[a.enumRefRecord.fields.enum_id],d.updateRow(a.enumRefRecord))};this.addNewEnum=function(){a.newEnum=d.getNewRowRef("enums");a.newEnum.fields.name=a.newEnumName;d.addRow(a.newEnum,
a.newEnumCallback);a.newEnumName="";a.isAddingEnum=!1};this.isEnumSelectable&&(a.myEnum=a.enums.indexed[a.enumRefRecord.fields.enum_id]);this.close=function(){b.hide()}}];DevCtrl.FkSelect={};DevCtrl.FkSelect.Directive=["DataService",function(b){return{scope:{tableName:"=table",field:"=",selectModel:"=",fkOnChange:"=",addNewOption:"="},bindToController:!0,controller:function(b){var a=this;this.options=b.getTable(this.tableName);this.schema=b.getSchema(this.tableName);this.updateValue=function(){angular.isFunction(a.fkOnChange)&&a.fkOnChange()}},controllerAs:"fkSelect",templateUrl:"ng/fk-select.html"}}];DevCtrl.Table={};
DevCtrl.Table.Ctrl=["$scope","$stateParams","DataService",function(b,d,a){var c=this;this.tableName=d.name;this.data=a.getTable(this.tableName);this.schema=a.getSchema(this.tableName);this.newRow={table:this.tableName};a.messenger.emit("status-update",{message:"table "+this.tableName+" loaded"});this.sortColumn="id";this.sortReversed=!1;this.setSortColumn=function(a){"fields."+a.name===this.sortColumn?this.sortReversed=!this.sortReversed:(this.sortColumn="fields."+a.name,this.sortReversed=!1)};this.deleteRow=
function(c){c.table=this.tableName;a.deleteRow(c)};this.fkDisplayVal=function(c,b){var d=a.getSchema(this.schema.foreign_keys[c.name]);if(!angular.isDefined(b.foreign[c.name]))return"";var e=b.foreign[c.name];if(null==e)return"NULL";var l=e.id;angular.isDefined(e.fields[d.fk_name])&&(l=e.fields[d.fk_name]);return l};this.addRow=function(b){a.editRecord(b,"0",c.tableName)};this.openRecord=function(b,d){a.editRecord(b,d,c.tableName)};this.updateRow=function(c,b){a.updateRow(b)}}];
DevCtrl.Table.Resolve={tableName:["$stateParams",function(b){return b.table}]};DevCtrl.Rooms={};DevCtrl.Rooms.Ctrl=["DataService",function(b){this.list=b.getTable("rooms").listed;this.imageUrl=function(b){return"/images/"+b.fields.name+".png"}}];DevCtrl.Panel={};
DevCtrl.Panel.Directive=["$mdDialog","DataService",function(b,d){return{scope:!0,bindToController:{panelObj:"="},controller:function(a,c){var b=this;this.fields=this.panelObj.fields;this.addControl=function(c){a.show({targetEvent:c,locals:{panelId:this.panelObj.id},controller:DevCtrl.PanelControlSelector.Ctrl,controllerAs:"selector",bindToController:!0,templateUrl:"ng/panel-control-selector.html",clickOutsideToClose:!0,hasBackdrop:!1})};this.editPanel=function(a){c.editRecord(a,this.panelObj.id,this.panelObj.tableName)};
this.setAllSwitches=function(a){angular.forEach(b.panelObj.referenced.panel_controls,function(b){b=b.foreign.controls;"switch"==b.fields.usertype&&(b.fields.value=a,c.updateControlValue(b))})}},controllerAs:"panel",templateUrl:"ng/panel.html"}}];DevCtrl.App=angular.module("DevCtrlApp",["ui.router","ngMaterial","btford.socket-io","angular-toArrayFilter"]).factory("DataService",DevCtrl.DataService.factory).factory("MenuService",DevCtrl.MenuService.factory).directive("ctrl",DevCtrl.Ctrl.Directive).directive("coeMenu",DevCtrl.Menu.Directive).directive("devctrlPanel",DevCtrl.Panel.Directive).directive("fkSelect",DevCtrl.FkSelect.Directive).directive("enumSelect",DevCtrl.EnumSelect.Directive).directive("devctrlSlider2d",DevCtrl.Slider2d.Directive).directive("devctrlObjectEditor",
DevCtrl.ObjectEditor.Directive).directive("devctrlAdminOnly",DevCtrl.AdminOnly.Directive).directive("devctrlEndpointStatus",DevCtrl.EndpointStatus.Directive).controller("MainCtrl",DevCtrl.MainCtrl).controller("EnumEditorCtrl",DevCtrl.EnumEditor.Ctrl).controller("PanelControlSelectorCtrl",DevCtrl.PanelControlSelector.Ctrl).controller("EndpointCtrl",DevCtrl.Endpoint.Ctrl).controller("LogCtrl",DevCtrl.Log.Ctrl).controller("TableCtrl",DevCtrl.Table.Ctrl).controller("RecordCtrl",DevCtrl.Record.Ctrl).controller("RoomCtrl",
DevCtrl.Room.Ctrl).controller("RoomsCtrl",DevCtrl.Rooms.Ctrl).config(DevCtrl.stateConfig).run(["$rootScope",function(b){b.$on("$stateChangeStart",function(b,a,c,g,h){console.log("$stateChangeStart to "+a.to+"- fired when the transition begins. toState,toParams : \n",a,c)});b.$on("$stateChangeError",function(b,a,c,g,h){console.log("$stateChangeError - fired when an error occurs during transition.");console.log(arguments)});b.$on("$stateChangeSuccess",function(b,a,c,g,h){console.log("$stateChangeSuccess to "+
a.name+"- fired once the state transition is complete.")});b.$on("$viewContentLoaded",function(b){console.log("$viewContentLoaded - fired after dom rendered",b)});b.$on("$stateNotFound",function(b,a,c,g){console.log("$stateNotFound "+a.to+"  - fired when a state cannot be found by its name.");console.log(a,c,g)})}]);
